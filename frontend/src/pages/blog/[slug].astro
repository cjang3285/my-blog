---
import Layout from '../../layouts/Layout.astro';
import { type GetStaticPaths } from 'astro';

export const getStaticPaths = (async () => {
  try {
    const response = await fetch('http://localhost:3000/api/posts');
    if (!response.ok) {
      console.error(`Failed to fetch posts: ${response.status} ${response.statusText}`);
      return [];
    }
    const posts = await response.json();
    return posts.map(post => ({
      params: { slug: post.slug },
      props: { post },
    }));
  } catch (error) {
    console.error('Error fetching posts for static paths:', error);
    return [];
  }
}) satisfies GetStaticPaths;

const { post } = Astro.props;
---

<Layout title={post.title} description={post.excerpt}>
  <article class="max-w-3xl mx-auto">
    <div class="mb-8">
      <a href="/blog" class="text-blue-400 hover:underline mb-4 block">&larr; 모든 글 목록으로 돌아가기</a>
      <h1 class="text-4xl font-bold mb-2">{post.title}</h1>
      <div class="flex items-center gap-2 text-sm text-gray-400">
        <time>{new Date(post.date).toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' })}</time>
        {post.tags && post.tags.length > 0 && <span>•</span>}
        <div class="flex gap-2">
          {post.tags.map(tag => <span class="text-blue-400">#{tag}</span>)}
        </div>
      </div>
    </div>
    <div class="text-gray-300 text-lg leading-relaxed">
      <p class="text-xl italic text-gray-400 mb-8">{post.excerpt}</p>
      <div class="w-full h-px bg-gray-800 my-8"></div>
      <div class="prose prose-invert max-w-none prose-p:text-lg prose-p:leading-relaxed whitespace-pre-wrap">{post.content}</div>
    </div>
  </article>
</Layout>
